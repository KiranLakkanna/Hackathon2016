<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Example of Bootstrap 3 Static Navbar</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="main.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="scripts.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 50%;
            margin: 0 auto;
            text-align: left;
            width: 800px;
        }
        .bs-example{
            margin: 20px;
        }
    </style>
</head>
<body>
<div class="bs-example">
    <nav role="navigation" class="navbar navbar-default navbar-static-top ">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <!-- <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
             </button>-->
            <div style="float:left;top: 21px;">
                <div class="open-intro" >
                    <span style="color: #337ab7;top: 21px;" class="glyphicon glyphicon-menu-hamburger"></span>
                </div>
                <div class="close-intro">
                    <span style="color: #337ab7;top: 21px;" class="glyphicon glyphicon-menu-hamburger"></span>
                </div>
            </div>

            <a  class="navbar-brand" href="http://disputebills.com <http://disputebills.com/> ">
                <img src="./images/tesco.gif">
            </a>


        </div>
        <!-- Collection of nav links and other content for toggling -->
        <!--    <div id="navbarCollapse" class="collapse navbar-collapse">
              <ul class="nav navbar-nav navbar-left">
                <li>
              <div class="open-intro">
                <span style="color: #337ab7;" class="glyphicon glyphicon-menu-hamburger">Menu</span>
              </div>
              <div class="close-intro">
                <span style="color: #337ab7;" class="glyphicon glyphicon-menu-hamburger">Menu</span>
              </div>
                </li>
              </ul>-->
        <!-- <ul class="nav navbar-nav navbar-right">
           <li></li>
         </ul>-->
</div>
</nav>
<div id="intro-wrap" style="float:left">
    <div style="margin-top: 6%; margin-left: 0" class="container">
        <div class="row">
            <div class="col-md-3">
                <ul  class="nav nav-pills nav-stacked" >
                    <li><a href="#"><span style="color:red" class="glyphicon glyphicon-home"></span> Home</a></li>
                    <li><a href="#"><span style="color:red" class="glyphicon glyphicon-heart"></span> Favourites & Lists</a></li>
                    <li><a href="#"><span style="color:red" class="glyphicon glyphicon-calendar"></span> Book a slot</a></li>
                    <li><a href="#"><span style="color:red" class="glyphicon glyphicon-shopping-cart"></span> My Orders</a></li>
                    <li><a href="#"><span style="color:red" class="glyphicon glyphicon-gift"></span> Special Offers</a></li>
                    <li><a href="/map.html"><span style="color:red" class="glyphicon glyphicon-map-marker"></span> Store Locator</a></li>
                </ul>
            </div>
            <div class="clearfix visible-lg"></div>
        </div>
    </div>
</div>
<!-- <button id="hide" style="margin-top: 5%" onclick="hide()">click</button>-->
<div id="map" ></div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js">
</script>
<script>
    // Note: This example requires that you consent to location sharing when
    // prompted by your browser. If you see the error "The Geolocation service
    // failed.", it means you probably did not give permission for the browser to
    // locate you.
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 51.776362, lng: -0.221038},
                    zoom: 15
                }),
                directionsService = new google.maps.DirectionsService,
                directionsDisplay = new google.maps.DirectionsRenderer({
                    map: map
                }),
                pointB=new google.maps.LatLng(12.999707,77.665443);
        //var infoWindow = new google.maps.InfoWindow({map: map});
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                var markerA = new google.maps.Marker({
                    position: pos,
                    map: map,
                    title: 'you are here'
                });
                markerB = new google.maps.Marker({
                    position: pointB,
                    title: "point B",
                    label: "B",
                    map: map
                });
                /* marker.addListener('click', function() {
                 infowindow.open(map, marker);
                 });*/
                //infoWindow.setPosition(pos);
                //infoWindow.setContent('Location found.');
                //map.setCenter(pos);
                findTescoStores(map);

                //calculateAndDisplayRoute(directionsService, directionsDisplay, pos, pointB);
            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }
    }
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
    }
    function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB) {
        directionsService.route({
            origin: pointA,
            destination: pointB,
            avoidTolls: true,
            avoidHighways: false,
            travelMode: google.maps.TravelMode.DRIVING
        }, function (response, status) {
            console.log(response);
            if (status == google.maps.DirectionsStatus.OK) {
                directionsDisplay.setDirections(response);
                console.log(directionsDisplay.setDirections(response));
            } else {
                window.alert('Directions request failed due to ' + status);
            }
        });
    }

    function findTescoStores(map){
        var arr = [];
        var names = [];
        $(document).ready(function($) {
            $.ajax({
                url: 'https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=51.776362,-0.221038&radius=5000&name=tesco+extra&key=AIzaSyDE2jTMpK7F6JomRIxb93_pDDPYW9VYTZs',
                dataType: 'json',
                success: function(r) {
                    for (var i = 0; i < r.results.length; i++) {
                        var item = r.results[i].geometry.location;
                        var markerLatlng = new google.maps.LatLng(item.lat, item.lng);
                        var latAndLong = {"lat": item.lat, "lng": item.lng};
                        arr.push(latAndLong);
                        names.push(r.results[i].name);
                        var marker = new google.maps.Marker({
                            position: markerLatlng,
                            label: r.results[i].name,
                            title: r.results[i].name
                        });
                        marker.item = item; // store information of each item in marker
                        marker.setMap(map); // where `map` is the instance of Google Map
                    }
                    gettimeanddistance(arr, names);
                    console.log("Success", r);
                },
                error: function(e){
                    console.log('error', e);
                }
            });
        })
    }
    function gettimeanddistance(arr, names){
        var send = [];
        var service = new google.maps.DistanceMatrixService();
        service.getDistanceMatrix({
            origins: [{lat: 51.776362, lng: -0.221038}],
            destinations: arr,
            travelMode: google.maps.TravelMode.DRIVING,
            unitSystem: google.maps.UnitSystem.METRIC,
            avoidHighways: false,
            avoidTolls: false
        }, function (response, status) {
            if (status == google.maps.DistanceMatrixStatus.OK && response.rows[0].elements[0].status != "ZERO_RESULTS") {
                var i = 0;
                console.log("Response", response);
                while(response.rows[0].elements[i]!== "") {
                    var distance = response.rows[0].elements[i].distance.text;
                    var duration = response.rows[0].elements[i].duration.text;
                    var name = names[i];
                    var final = {
                        "distance": distance,
                        "duration": duration,
                        "name": name
                    };
                    send.push(final);
                    i++;
                    console.log("Send", send);
                }
                return send;
            } else {
                alert("Unable to find the distance via road.");
            }
        })
    }



</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAimxuIpdP3gQLQoVO2b8j6UzRXREAZtvQ&callback=initMap">
</script>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button  type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">You are Special to TESCO.. We have something for you</h4>
            </div>
            <div id ="offerMsg" class="modal-body">
            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>
</body>
</html>